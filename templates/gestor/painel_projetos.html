{% extends 'gestor/base_gestor.html' %}
{% load formato_br %}

{% block title %}Painel de Projetos | Portal Gestor{% endblock %}

{% block content %}
<div class="container-fluid px-4">
<div class="card shadow">
  <div class="card-header bg-light d-flex justify-content-between align-items-center">
    <h5 class="card-title mb-0">
      <i class="fas fa-plane-departure me-2"></i>Painel de Projetos
    </h5>
    <div>
      <a href="{% url 'gestor:dashboard' %}" class="btn btn-outline-secondary btn-sm">
        <i class="fas fa-arrow-left me-1"></i> Voltar
      </a>
    </div>
  </div>

  <div class="card-body py-2">
    <div class="table-responsive">
      <table class="table table-hover table-sm align-middle mb-0" style="font-size: 0.75rem;">
        <thead class="table-light">
          <tr>
            <th width="8%">Número</th>
            <th width="20%">Cliente</th>
            <th width="12%">Aprovação</th>
            <th width="14%">Entrega Obra Prevista</th>
            <th width="12%">Início Produção</th>
            <th width="14%">Previsão Entrega</th>
            <th width="5%" class="text-center">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for proposta in propostas %}
            <tr>
              <td>
                <strong class="text-primary">{{ proposta.numero }}</strong>
              </td>

              <td>
                <div class="text-truncate" style="max-width: 180px;" title="{{ proposta.cliente.nome }}">
                  <strong>{{ proposta.cliente.nome }}</strong>
                </div>
              </td>

              <td>
                {% if proposta.data_aprovacao %}
                  <strong>{{ proposta.data_aprovacao|date:"d/m/Y" }}</strong>
                {% else %}
                  <span class="text-muted fst-italic" style="font-size: 0.75rem;">-</span>
                {% endif %}
              </td>

              <td>
                {% if proposta.data_previsao_entrega_obra %}
                  {{ proposta.data_previsao_entrega_obra|date:"d/m/Y" }}
                {% else %}
                  <span class="text-muted fst-italic" style="font-size: 0.75rem;">-</span>
                {% endif %}
              </td>

              <td>
                {% if proposta.data_inicio_producao %}
                  {{ proposta.data_inicio_producao|date:"d/m/Y" }}
                {% else %}
                  <span class="text-muted fst-italic" style="font-size: 0.75rem;">-</span>
                {% endif %}
              </td>

              <td>
                {% if proposta.data_previsao_entrega %}
                  {{ proposta.data_previsao_entrega|date:"d/m/Y" }}
                {% else %}
                  <span class="text-muted fst-italic" style="font-size: 0.75rem;">-</span>
                {% endif %}
              </td>

              <td class="text-center">
                <a href="{% url 'gestor:projeto_detail' proposta.pk %}"
                   class="btn btn-sm btn-outline-primary"
                   title="Ver Detalhes"
                   data-bs-toggle="tooltip">
                  <i class="fas fa-eye"></i>
                </a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" class="text-center py-5">
                <div class="empty-state">
                  <i class="fas fa-inbox fa-3x mb-3 text-muted"></i>
                  <h5 class="text-muted">Nenhum projeto aprovado encontrado</h5>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Aumentar largura e diminuir fonte */
.container-fluid {
    max-width: 100% !important;
}

/* Tabela compacta */
.table-sm td, .table-sm th {
    padding: 0.35rem 0.25rem;
    font-size: 0.75rem;
}

/* Headers menores */
.table thead th {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

/* Números em destaque */
.text-primary {
    font-size: 0.85rem !important;
}

/* Hover mais suave */
.table-hover tbody tr:hover {
    background-color: rgba(0, 123, 255, 0.03);
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar tooltips
    if (window.innerWidth > 768) {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    }
});
</script>
{% endblock %}
