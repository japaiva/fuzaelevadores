<!-- TAB RESUMO -->
{% load formato_br %}
{% load pedido_filters %}

<div class="tab-pane fade show active" id="resumo" role="tabpanel">
  <div class="card-body">
    
    <!-- Dados da Proposta -->
    <div class="card shadow-sm border-primary mb-4">
      <div class="card-header bg-primary text-white">
        <div class="d-flex justify-content-between align-items-center">
          <h6 class="card-title mb-0">Dados da Proposta</h6>
          <span class="badge bg-light text-primary fs-6">{{ pedido.numero }}</span>
        </div>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label text-muted small">Cliente</label>
              <div class="form-control-plaintext"><strong>{{ pedido.cliente.nome }}</strong></div>
              {% if pedido.cliente.nome_fantasia %}
                <small class="text-muted">{{ pedido.cliente.nome_fantasia }}</small>
              {% endif %}
            </div>
            <div class="mb-3">
              <label class="form-label text-muted small">Vendedor</label>
              <div class="form-control-plaintext">{{ pedido.vendedor.get_full_name|default:pedido.vendedor.username }}</div>
            </div>
            <div class="mb-3">
              <label class="form-label text-muted small">Nome do Projeto</label>
              <div class="form-control-plaintext"><strong>{{ pedido.nome_projeto }}</strong></div>
            </div>
            <div class="mb-3">
              <label class="form-label text-muted small">Faturado por</label>
              <div class="form-control-plaintext">{{ pedido.get_faturado_por_display }}</div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label text-muted small">Data de Criação</label>
              <div class="form-control-plaintext">{{ pedido.criado_em|date:"d/m/Y H:i" }}</div>
            </div>
            <div class="mb-3">
              <label class="form-label text-muted small">Modelo do Elevador</label>
              <div class="form-control-plaintext"><strong>{{ pedido.get_modelo_elevador_display }}</strong></div>
            </div>
            <div class="mb-3">
              <label class="form-label text-muted small">Capacidade</label>
              <div class="form-control-plaintext"><strong>{{ pedido.capacidade }} kg</strong></div>
            </div>
            {% if pedido.observacoes %}
            <div class="mb-3">
              <label class="form-label text-muted small">Observações</label>
              <div class="form-control-plaintext">{{ pedido.observacoes }}</div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Valores e Comercial -->
    <div class="card shadow-sm border-success mb-4">
      <div class="card-header bg-success text-white">
        <h6 class="card-title mb-0">Valores e Comercial</h6>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="mb-3">
              <label class="form-label text-muted small">Valor Base (Calculado)</label>
              <div class="form-control-plaintext text-info">
                <strong>R$ {{ pedido.preco_venda_calculado|formato_br|default:"0,00" }}</strong>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label text-muted small">Valor Final da Proposta</label>
              <div class="form-control-plaintext text-success">
                <strong>R$ {{ pedido.valor_proposta|formato_br|default:"0,00" }}</strong>
              </div>
              {% if pedido.percentual_desconto > 0 %}
                <small class="text-muted">
                  <i class="fas fa-tag me-1"></i>
                  Desconto: {{ pedido.percentual_desconto|floatformat:1 }}%
                </small>
              {% endif %}
            </div>
            {% if pedido.prazo_entrega_dias %}
            <div class="mb-3">
              <label class="form-label text-muted small">Prazo de Entrega</label>
              <div class="form-control-plaintext">{{ pedido.prazo_entrega_dias }} dias</div>
            </div>
            {% endif %}
          </div>
          
          <div class="col-md-6">
            {% if pedido.data_validade %}
            <div class="mb-3">
              <label class="form-label text-muted small">Validade da Proposta</label>
              <div class="form-control-plaintext">
                {{ pedido.data_validade|date:"d/m/Y" }}
                {% if pedido.esta_vencida %}
                  <small class="text-danger">(Vencida)</small>
                {% elif pedido.dias_para_vencer <= 7 %}
                  <small class="text-warning">({{ pedido.dias_para_vencer }} dias)</small>
                {% endif %}
              </div>
            </div>
            {% endif %}
            
            {% if pedido.forma_pagamento %}
            <div class="mb-3">
              <label class="form-label text-muted small">Forma de Pagamento</label>
              <div class="form-control-plaintext">
                <strong>{{ pedido.get_forma_pagamento_display_detalhado }}</strong>
              </div>
            </div>
            {% endif %}
            
            {% if pedido.valor_entrada %}
            <div class="mb-3">
              <label class="form-label text-muted small">Valor da Entrada</label>
              <div class="form-control-plaintext">R$ {{ pedido.valor_entrada|formato_br }}</div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Parcelamento (se houver) -->
    {% if pedido.numero_parcelas and pedido.numero_parcelas > 1 %}
    <div class="card shadow-sm border-warning mb-4">
      <div class="card-header bg-warning text-dark">
        <h6 class="card-title mb-0">Parcelamento</h6>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label text-muted small">Número de Parcelas</label>
            <div class="form-control-plaintext"><strong>{{ pedido.numero_parcelas }}x</strong></div>
          </div>
          {% if pedido.valor_parcela %}
          <div class="col-md-3">
            <label class="form-label text-muted small">Valor da Parcela</label>
            <div class="form-control-plaintext">R$ {{ pedido.valor_parcela|formato_br }}</div>
          </div>
          {% endif %}
          {% if pedido.tipo_parcela %}
          <div class="col-md-3">
            <label class="form-label text-muted small">Tipo de Parcela</label>
            <div class="form-control-plaintext">{{ pedido.get_tipo_parcela_display }}</div>
          </div>
          {% endif %}
          {% if pedido.primeira_parcela %}
          <div class="col-md-3">
            <label class="form-label text-muted small">1ª Parcela</label>
            <div class="form-control-plaintext">{{ pedido.primeira_parcela|date:"d/m/Y" }}</div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Resumo de Custos -->
    {% if pedido.custo_producao or pedido.custo_materiais %}
    <div class="card shadow-sm border-info mb-4">
      <div class="card-header bg-info text-white">
        <h6 class="card-title mb-0">Resumo de Custos (Interno)</h6>
      </div>
      <div class="card-body">
        <div class="row g-3 text-center">
          {% if pedido.custo_materiais %}
          <div class="col-md-3">
            <div class="border rounded p-3 bg-light">
              <strong class="d-block text-primary fs-5">R$ {{ pedido.custo_materiais|formato_br }}</strong>
              <small class="text-muted">Materiais</small>
            </div>
          </div>
          {% endif %}
          
          {% if pedido.custo_mao_obra %}
          <div class="col-md-3">
            <div class="border rounded p-3 bg-light">
              <strong class="d-block text-info fs-5">R$ {{ pedido.custo_mao_obra|formato_br }}</strong>
              <small class="text-muted">Mão de Obra</small>
            </div>
          </div>
          {% endif %}
          
          {% if pedido.custo_instalacao %}
          <div class="col-md-3">
            <div class="border rounded p-3 bg-light">
              <strong class="d-block text-dark fs-5">R$ {{ pedido.custo_instalacao|formato_br }}</strong>
              <small class="text-muted">Instalação</small>
            </div>
          </div>
          {% endif %}
          
          {% if pedido.custo_producao %}
          <div class="col-md-3">
            <div class="border rounded p-3 bg-primary text-white">
              <strong class="d-block fs-5">R$ {{ pedido.custo_producao|formato_br }}</strong>
              <small>TOTAL</small>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}
    
  </div>
</div>